<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Optotipos • Snellen | E | Landolt C | Números | Infantil + Amsler • Astigmatismo • PDF</title>
<script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
  :root{--fg:#111;--bg:#fff;--mut:#777;--line:#e5e5e5}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;z-index:5;display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line);background:var(--bg)}
  header .grp{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
  header label{font-size:13px;opacity:.9}
  header input[type="number"],header select{padding:6px}
  header input[type="number"]{width:6.2rem}
  .btn{padding:6px 10px;border:1px solid #999;background:#f7f7f7;border-radius:6px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .small{font-size:12px;color:var(--mut)}
  .pill{padding:6px 10px;border:1px solid #999;border-radius:999px;background:#fafafa;cursor:pointer}
  main{min-height:calc(100vh - 64px);display:flex;flex-direction:column}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;padding:8px 12px;border-bottom:1px solid var(--line);background:var(--bg)}
  .tab{padding:6px 10px;border:1px solid #999;border-radius:8px;background:#f7f7f7;cursor:pointer}
  .tab.active{background:#e9f3ff;border-color:#5aa0ff}
  .stage{flex:1;display:none}
  .stage.active{display:flex}
  .chartWrapper{flex:1;display:flex;align-items:center;justify-content:center;padding:18px 10px}
  #chart{width:100%;max-width:1200px;display:grid;gap:18px;align-content:start;justify-items:center}
  .rowWrap{display:flex;flex-direction:column;align-items:center}
  .row{display:flex;gap:1ch;justify-content:center;align-items:flex-end;line-height:1}
  .cell{display:inline-block;font-weight:700;user-select:none;-webkit-user-select:none}
  .tumble{display:inline-block;transform-origin:50% 50%}
  .label{font-size:12px;text-align:center;margin-top:4px;color:var(--mut)}
  .calSection{padding:8px 10px 16px;display:flex;flex-direction:column;align-items:center}
  .barWrap{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:6px}
  .bar{height:12px;background:#ccc;border:1px solid #999;box-shadow:inset 0 0 0 2px #eee}
  .toolWrap{flex:1;display:flex;align-items:center;justify-content:center}
  canvas{max-width:92vw;max-height:78vh;background:var(--bg)}
  .panel{padding:12px;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .panel h3{grid-column:1/-1;margin:.2rem 0}
  .field{display:flex;flex-direction:column}
  .field label{font-size:12px;color:var(--mut)}
  .dark{--fg:#f5f5f5;--bg:#0e0f12;--mut:#a7a7a7;--line:#2a2a2a}
  .dark .btn,.dark .tab,.dark .pill{background:#1b1d22;border-color:#3a3a3a;color:#f1f1f1}
  .fs .panel,.fs .calSection,.fs header{display:none}
</style>
</head>
<body>
<header>
  <div class="grp">
    <label>Modo:
      <select id="mode">
        <option value="snellen" selected>Snellen (filas)</option>
        <option value="amsler">Amsler</option>
        <option value="astig">Reloj de astigmatismo</option>
        <option value="ishihara">Ishihara (demo)</option>
      </select>
    </label>
  </div>
  <div class="grp" id="snellenControls">
    <label>Distancia (m):<input id="distanceM" type="number" min="0.5" max="10" step="0.1" value="3.0"></label>
    <label>Signos:<select id="alphabet"><option value="sloan">Sloan</option><option value="tumbleE">E</option><option value="landolt">Landolt C</option><option value="digits">Números</option><option value="kids">Infantil</option></select></label>
    <label>Vista:<select id="viewMode"><option value="all">Todas</option><option value="one" selected>Una</option></select></label>
    <button id="prevRow" class="btn">⟵</button><button id="nextRow" class="btn">⟶</button><button id="shuffle" class="btn">↻</button><span id="rowInfo" class="small"></span>
  </div>
  <div class="grp"><button id="darkToggle" class="pill">Modo oscuro</button><button id="fullToggle" class="pill">Pantalla completa</button></div>
</header>
<main>
  <section id="stageSnellen" class="stage active"><div class="chartWrapper"><section id="chart"></section></div></section>
  <section id="stageAmsler" class="stage"><div class="toolWrap"><canvas id="amsler" width="900" height="900"></canvas></div></section>
  <section id="stageAstig" class="stage"><div class="toolWrap"><canvas id="astig" width="1000" height="1000"></canvas></div></section>
  <section id="stageIshi" class="stage"><div class="toolWrap"><canvas id="ishi" width="900" height="900"></canvas></div></section>
  <section class="calSection"><h3 class="small">Calibración</h3><div class="barWrap"><div id="calBar" class="bar" style="width:200px"></div><input id="barRange" type="range" min="50" max="600" step="1" value="200"><button id="lockCal" class="btn">✔ Guardar</button></div></section>
  <section class="panel"><h3>Resultado / Historia</h3><div class="field"><label>Paciente</label><input id="p_nombre"/></div><div class="field"><label>Fecha</label><input id="p_fecha" type="date"/></div><button id="pdfBtn" class="btn">Guardar PDF</button></section>
</main>
<script>
const SNELLEN_SEQ=[400,200,100,70,50,40,30,25,20];
const $=s=>document.querySelector(s);
const fullToggle=$('#fullToggle');
let currentRow=0;const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const modeSel=$('#mode'),viewMode=$('#viewMode');
function render(){}
fullToggle.addEventListener('click',()=>{if(!document.fullscreenElement){document.documentElement.requestFullscreen?.();}else{document.exitFullscreen?.();}});
document.addEventListener('fullscreenchange',()=>{document.body.classList.toggle('fs',!!document.fullscreenElement)});
window.addEventListener('wheel',e=>{if(modeSel.value!=='snellen'||viewMode.value!=='one')return;if(e.deltaY>0){currentRow=clamp(currentRow+1,0,SNELLEN_SEQ.length-1);}else{currentRow=clamp(currentRow-1,0,SNELLEN_SEQ.length-1);}render();e.preventDefault();},{passive:false});
</script>
</body>
</html>
